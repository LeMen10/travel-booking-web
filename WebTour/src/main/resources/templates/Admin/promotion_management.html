<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quản lý khuyến mãi</title>
<link rel="stylesheet" href="/css/home_admin.css">
<link rel="stylesheet" href="/css/modal.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/css/promotion.css">
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
	rel="stylesheet" />
<link
	href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&amp;display=swap"
	rel="stylesheet" />
</head>

<body>
	<div class="sidebar">
		<div class="logo">
			<img alt="" height="50" src="" width="50" />
		</div>
		<ul class="nav">
			<li><a href="#"> <i class="fas fa-home"> </i> Dashboard
			</a></li>
			<li><a href="#"> <i class="fas fa-envelope"> </i> Email
			</a></li>
			<li><a th:href="@{/admin/customer-management}"> <i
					class="fas fa-edit"> </i> Customer
			</a></li>
			<li><a th:href="@{/admin/promotion-management}"> <i
					class="fas fa-edit"> </i> Promotion
			</a></li>
		</ul>
	</div>
	<div class="main-content">
		<div class="header">
			<div class="search-bar">
				<input placeholder="Search..." type="text" /> <i
					class="fas fa-search"> </i>
			</div>
			<div class="user-info">
				<img alt="User Avatar" height="40"
					src="https://storage.googleapis.com/a1aa/image/IkIPh4GKaG77KZx7nvUG3GOohf7MoegCFbHKFOjpxjycEvjTA.jpg"
					width="40" /> <span> John Doe </span>
			</div>
		</div>
		<div class="tab-content">
			<div class="tab-title-promotion mb-20">
				<h1 class="title-promotion">Khuyến mãi</h1>
<<<<<<< Updated upstream
				<p class="create-promotion-btn" id="add-promotion-btn">Tạo
					khuyến mãi</p>
			</div>

			<div class="filter">
				<div class="d-flex space-between">
					<label for="" class="align-center d-flex mr-10">Ngày bắt đầu</label>
					<input type="date" id="datetime-start-filter" class="datetime-start mr-50"
						name="datetime">
				</div>
				<div class="d-flex space-between">
					<label for="" class="align-center d-flex mr-10">Ngày hết hạn</label>
					<input type="date" id="datetime-end-filter" class="datetime-end mr-10"
						name="datetime">
				</div>
				<button id="filter-promotion-byDate">Lọc</button>
=======
				<p class="create-promotion-btn"  id="add-promotion-btn">Tạo
					khuyến mãi</p>
			</div>
			<div class="tabs">
				<a href="#" class="active">Mã khuyến mãi</a> <a href="#">Chương
					trình khuyến mãi</a>
			</div>
			<div class="filter">
				<input type="text" placeholder="Lọc khuyến mãi..."> <input
					type="text" placeholder="Tìm kiếm khuyến mãi...">
				<button>Lọc</button>
>>>>>>> Stashed changes
			</div>
			<table class="table">
				<thead>
					<tr>
						<th class="large-column">Mã khuyến mãi</th>
<<<<<<< Updated upstream
						<th class="small-column">Chi tiết</th>
=======
						<th class="small-column">Chi tiết</th> 
>>>>>>> Stashed changes
						<th class="mid-column">Phần trăm</th>
						<th class="large-column">Bắt đầu</th>
						<th class="large-column">Kết thúc</th>
					</tr>
				</thead>
<<<<<<< Updated upstream
				<tbody id="promotion-table-body">
					<tr th:each="promotion : ${promotions}"
						th:attr="data-id=${promotion.promotionId}"
						onclick="getPromotionId(this)">
						<td th:text="${promotion.code}"></td>
						<td th:text="${promotion.description}" class="text-left"></td>
						<td th:text="${promotion.discount + '%'}"></td>
=======
				<tbody>
					<tr th:each="promotion : ${promotions}">
						<td th:text="${promotion.code}"></td>
						<td th:text="${promotion.description}" class="text-left"></td>
						<td th:text="${promotion.discount}"></td>
>>>>>>> Stashed changes
						<td th:text="${promotion.startDate}"></td>
						<td th:text="${promotion.endDate}"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
<<<<<<< Updated upstream

=======
>>>>>>> Stashed changes
	<div class="modal" id="add-promotion-modal">
		<div class="modal__overlay"></div>
		<div class="modal__body">
			<!-- Login form  -->
			<div class="auth-form ">
				<div class="auth-form__container js-modal-container-quen">
					<div class="auth-form__header">
						<h3 class="auth-form__heading">Thêm mới mã khuyến mãi</h3>
					</div>

					<div class="auth-form__form">
						<div class="auth-form__group">
							<div class="d-flex space-between">
								<label for="name" class="weight-6">Mã khuyến mãi *</label>
<<<<<<< Updated upstream
								<p id="random-string" class="random-string">Sinh mã ngẫu
									nhiên</p>
=======
								<p id="random-string" class="random-string">Sinh mã ngẫu nhiên</p>
>>>>>>> Stashed changes
							</div>
							<input type="text" placeholder=" " class="auth-form__input mt-8"
								id="promotion-code">
							<div class="error"></div>
						</div>
						<div class="auth-form__group mt-16">
<<<<<<< Updated upstream
							<p for="name" class="pro-cate weight-6">Phần trăm khuyến mãi
								*</p>
=======
							<p for="name" class="pro-cate weight-6">Phần trăm khuyến mãi *</p>
>>>>>>> Stashed changes

							<div class="pd-bt-6px">
								<input type="text" name="promotion" value="" id="discount"
									class="auth-form__input">
							</div>


						</div>

						<div class="auth-form__group mt-16">
							<p class="weight-6">Thời gian *</p>
							<div class="mt-8">
								<div class="d-flex space-between">
<<<<<<< Updated upstream
									<label for="" class="align-center d-flex">Thời gian bắt
										đầu</label> <input type="date" id="datetime-start"
										class="datetime-start" name="datetime">
								</div>
								<div class="d-flex space-between mt-8">
									<label for="" class="align-center d-flex">Thời gian kết
										thúc</label> <input type="date" id="datetime-end" class="datetime-end"
										name="datetime">
=======
									<label for="" class="align-center d-flex">Thời gian bắt đầu</label>
									<input type="date" id="datetime-start" class="datetime-start" name="datetime">
								</div>
								<div class="d-flex space-between mt-8">
									<label for="" class="align-center d-flex">Thời gian kết thúc</label>
									<input type="date" id="datetime-end" class="datetime-end" name="datetime">
>>>>>>> Stashed changes
								</div>
							</div>
						</div>

						<div class="auth-form__group mt-16">
							<label for="name" class="weight-6">Chi tiết</label>
<<<<<<< Updated upstream
							<textarea rows="6" class="w-max mt-8 description"
								id="description"></textarea>
=======
							<textarea rows="6" class="w-max mt-8 description" id="description"></textarea>
>>>>>>> Stashed changes
							<div class="error"></div>
						</div>
					</div>

					<div class="auth-form__control">
<<<<<<< Updated upstream
						<button class="btn auth-form__control-back btn--normal btn-cancel"
							id="close-modal-btn">Trở lại</button>
						<button class="btn btn--primary view-cart btn-confirm"
							id="getData">Xác nhận</button>
=======
						<button
							class="btn auth-form__control-back btn--normal btn-cancel" id="close-modal-btn">Trở lại</button>
						<button class="btn btn--primary view-cart btn-confirm" id="getData">Xác nhận</button>
>>>>>>> Stashed changes
					</div>
				</div>
			</div>
		</div>
	</div>

<<<<<<< Updated upstream
	<div class="modal" id="promotional-program-modal">
		<div class="modal__overlay"></div>
		<div class="modal__body">
			<!-- Login form  -->
			<div class="auth-form-program">
				<div class="auth-form__container">
					<div class="auth-form__header">
						<h3 class="auth-form__heading">Dánh sách các tuyến du lịch</h3>
					</div>

					<div class="auth-form__form">
						<table class="table">
							<thead>
								<tr>
									<th class="small-column">Chuyến du lịch</th>
									<th class="mid-column">Giá</th>
									<th class="large-column">Bắt đầu</th>
									<th class="large-column">Kết thúc</th>
									<th class="large-column">Hành động</th>
								</tr>
							</thead>
							<tbody id="tours-body">

							</tbody>
						</table>
					</div>

					<div class="auth-form__control">
						<button class="btn auth-form__control-back btn--normal btn-cancel"
							id="close-promotional-program-btn">Trở lại</button>
						<button class="btn btn--primary view-cart btn-confirm"
							id="savePromotionDetails">Xác nhận</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="../js/promotion.js"></script>
=======
	<script type="text/javascript">
		const generateRandomString = (length) => {
			const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
			let result = '';

			for (let i = 0; i < length; i++) {
				const randomIndex = Math.floor(Math.random()
						* characters.length);
				result += characters[randomIndex];
			}
			return result;
		}
		
		const promotionCode = document.getElementById("promotion-code");
	    const discount = document.getElementById("discount");
	    const startTime = document.getElementById("datetime-start");
	    const endTime = document.getElementById("datetime-end");
	    const description = document.getElementById("description");

		let randomString = document.getElementById('random-string');
		let modal = document.getElementById('add-promotion-modal');
		let close = document.getElementById('close-modal-btn');
		
		randomString.addEventListener('click', function() {
			promotionCode.value = generateRandomString(12);
		});
		
		document.getElementById("add-promotion-btn").addEventListener("click", async function(event) {
			event.preventDefault();
			modal.classList.add('d-flex');
		});
		
		const removeModal = () => {
			modal.classList.remove('d-flex');
			promotionCode.value = '',
	        discount.value = '',
	        startTime.value = '',
	        endTime.value = '',
	        description.value = ''
		}
		
		close.addEventListener("click", async function(event) {
			event.preventDefault();
			removeModal();
		});
		
		document.getElementById("getData").addEventListener("click", async function(event) {
		    event.preventDefault();

		    const data = {
		        code: promotionCode.value,
		        discount: discount.value,
		        startDate: startTime.value,
		        endDate: endTime.value,
		        description: description.value
		    };

		    try {
		        const response = await fetch("/admin/add-promotion", {
		            method: "POST",
		            headers: {
		                "Content-Type": "application/json"
		            },
		            body: JSON.stringify(data)
		        });

		        if (!response.ok) {
			        if (response.status == 400) return alert("Mã khuyến mãi bị trùng.");
		        }

		        const rs = await response.json();
		        if (rs.status == 200) location.reload();
		        
		    } catch (error) {
		        console.log( error);
		        alert("Đã xảy ra lỗi khi gửi dữ liệu");
		    }
		});

	</script>
>>>>>>> Stashed changes
</body>
</html>



