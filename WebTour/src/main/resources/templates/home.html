<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ND Travel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
     <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <link rel="shortcut icon" href="/image/icon.png" type="image/x-icon">
    <link rel="stylesheet" href="/css/home_user.css">
</head>
<body>
	<header>
    <div class="container">
        <div class="container">
            <div class="logo">
                <a href="home.html"><img src="/image/Logo.png" alt="ND Travel Logo"></a>
            </div>
            <nav>
                <ul>
                    <li><a href="/home" id="home-link">Trang chủ</a></li>
                    <li class="dropdown">
                        <a href="" class="dropbtn" id="about-link">Giới thiệu</a>
                    </li>
                    <li class="dropdown">
                        <a href="/search?s=" class="dropbtn" id="tour-link">Tour du lịch</a>
                    </li>
                    <li><a href="#" id="news-link">Tin tức</a></li>
                    <li><a href="#" id="faq-link">FAQs</a></li>
                    <li><a href="#" id="contact-link">Liên hệ</a></li>
                </ul>
            </nav>            
            <div class="icons">
                <a href="#"><i class="fas fa-search btn-search"></i></a>
                <a href="/"><i class="fa-regular fa-circle-user"></i></a>
                <a href="#"><i class="fas fa-shopping-cart"></i></a>
                <span class="hotline">
                    <i class="fa-solid fa-headset"></i>
                    Hotline 1900 9999
                </span>
            </div>         
        </div>

        <!-- Div phụ (search-box) -->
        <div class="search-box" id="searchBox">
            <div class="empty-box" id="emptyBox"></div>
            <div class="search-top">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="Nhập tên tour...">
                    <i class="fas fa-search" id="searchIcon"></i>
                </div>
            </div>
        </div>
      </div>
     </header>
	        <header class="header">
	        <div class="overlay">
	            <div class="content">
	                <h1>Du lịch cùng ND TRAVEL</h1>
	                <p>Vinh hạnh của chúng tôi là mang đến cho bạn những chuyến đi đáng nhớ. 
	                Mang đến cho bạn những chuyến đi đầy cảm hứng. Khám phá những vùng đất mới. Tự do khám phá cùng chúng tôi.</p>
	            </div>
	        </div>
	        <section class="search-section">
	        <form class="search-form">
	            <i class="fa-solid fa-location-dot"></i>
				<input type="text" placeholder="Chọn điểm đi" class="input-field">
	            <i class="fa-solid fa-plane-departure"></i>
	            <select id="departureSelect" class="location-select" data-type="departure">
	                <option value="" disabled selected>Chọn điểm đi</option>
					<option th:each="provinces: ${province}" th:value="${provinces.provinceId}" th:text="${provinces.name}">Chọn điểm đi</option>
				</select>
	            <i class="fa-solid fa-plane-arrival"></i>
	             <select id="destinationSelect" class="location-select" data-type="destination">
	                <option value="" disabled selected>Chọn điểm đến</option>
					<option th:each="provinces: ${province}" th:value="${provinces.provinceId}" th:text="${provinces.name}">Chọn điểm đi</option>
					</select>
	            <i class="fa-solid fa-calendar-days"></i>
	            <input type="date" class="input-field">
	            <button type="submit" id ="main-btn-search">Tìm kiếm</button>
	        </form>
	    </section>
	    </header>
	    
	    <section class="why-choose-section">
	        <h2>Vì sao bạn nên chọn ND Travel</h2>
	        <div class="features">
	            <div class="feature">
	                <i class="fa-solid fa-filter-circle-dollar"></i>
	                <div class="text">
	                    <h3>Giá tốt nhất cho bạn</h3>
	                    <p>Có nhiều mức giá đa dạng phù hợp với ngân sách và nhu cầu của bạn.</p>
	                </div>
	            </div>
	            <div class="feature">
	                <i class="fa-solid fa-ticket"></i>
	                <div class="text">
	                    <h3>Booking dễ dàng</h3>
	                    <p>Các bước booking và chăm sóc khách hàng nhanh chóng và thuận tiện.</p>
	                </div>
	            </div>
	            <div class="feature">
	                <i class="fa-solid fa-suitcase-rolling"></i>
	                <div class="text">
	                    <h3>Tour du lịch tối ưu</h3>
	                    <p>Đa dạng các loại hình tour du lịch với nhiều mức giá khác nhau.</p>
	                </div>
	                
	            </div>
	        </div>
	    </section>
	    
	    <section class="booking-process-section">
	        <h2>Booking cùng ND Travel</h2>
	        <p>Chỉ với 3 bước đơn giản và dễ dàng có ngay trải nghiệm tuyệt vời!</p>
	        <div class="steps">
	            <div class="step">
	                <div class="step-number">1</div>
	                <img src="/image/location.png" alt="Find Destination Icon">
	                <h3>Tìm nơi muốn đến</h3>
	                <p>Bất cứ nơi đâu bạn muốn đến, chúng tôi có tất cả những gì bạn cần.</p>
	            </div>
	            <div class="step">
	                <div class="step-number">2</div>
	                <img src="/image/ticket.png" alt="Book Ticket Icon">
	                <h3>Đặt vé</h3>
	                <p>ND Travel sẽ hỗ trợ bạn đặt vé trực tiếp nhanh chóng và thuận tiện.</p>
	            </div>
	            <div class="step">
	                <div class="step-number">3</div>
	                <img src="/image/payment.png" alt="Payment Icon">
	                <h3>Thanh toán</h3>
	                <p>Hoàn thành bước thanh toán và sẵn sàng cho chuyến đi ngay thôi.</p>
	            </div>
	        </div>
	    </section>
	    <section class="tour-deals">
	        <h2>Tour giá tốt</h2>
	        <p>Hơn 1.000 tour đa dạng giá hời có hạn</p>
	        <div class="tour-cards">
	            <div th:each="tour : ${tours}" class="tour-card">
	                <!-- <img th:src="@{${tour.image}}" alt="Tour Image"> -->
	                <div class="tour-info">
	                    <p class="departure"><i class="fa-solid fa-location-dot"></i> Khởi hành từ: <span th:text="${tour.departure}"></span></p>
	                    <h3 th:text="${tour.tourName}"></h3>
	                    <p class="price" th:text="${tour.price} + ' VNĐ'"></p>
	                    <p class="duration">Ngày đi: <span th:text="${tour.startDate}"></span></p>
	                    <p class="duration">Ngày về: <span th:text="${tour.endDate}"></span></p>
	                </div>
	            </div>
	        </div>
	        <a href="#" class="see-more">Xem thêm →</a>
	    </section>
    

        <script>
            const searchBox = document.getElementById('searchBox');
            const emptyBox = document.getElementById('emptyBox');
            const searchBtn = document.querySelector('.btn-search');
        
            // Hàm để hiển thị hoặc ẩn search-box với hiệu ứng
            const toggleSearchBox = () => {
                if (searchBox.classList.contains('active')) {
                    // Nếu đang hiển thị, ẩn đi
                    searchBox.classList.remove('active');
                    setTimeout(() => {
                        searchBox.style.display = 'none'; // Ẩn hoàn toàn sau khi hiệu ứng kết thúc
                    }, 300); // Thời gian trùng khớp với thời gian hiệu ứng CSS
                } else {
                    // Nếu đang ẩn, hiển thị
                    searchBox.style.display = 'flex'; // Hiển thị trước khi thêm lớp active
                    setTimeout(() => {
                        searchBox.classList.add('active'); // Thêm lớp active để hiển thị hiệu ứng
                    }, 10); // Thời gian nhỏ để đảm bảo display: flex đã được áp dụng
                }
            };
        
            // Hiển thị search-box khi nhấn vào nút tìm kiếm
            searchBtn.addEventListener('click', toggleSearchBox);
        
            // Ẩn search-box khi nhấn vào nền (empty-box)
            emptyBox.addEventListener('click', () => {
                searchBox.classList.remove('active'); // Xóa lớp active khi nhấn vào nền
                setTimeout(() => {
                    searchBox.style.display = 'none'; // Ẩn hoàn toàn sau khi hiệu ứng kết thúc
                }, 300); // Thời gian trùng khớp với thời gian hiệu ứng CSS
            });
             // Lấy các phần tử
                const searchInput = document.getElementById('searchInput');
                const mainsearchInput = document.getElementById('mainSearchInput');
                const searchIcon = document.getElementById('searchIcon');
        
                // Hàm chuyển hướng
                function redirectToSearch() {
                    const query = searchInput.value.trim(); // Lấy giá trị nhập vào và loại bỏ khoảng trắng thừa
                    if (query) {
                        // Chuyển hướng đến URL mới, có thể tùy chỉnh URL này theo nhu cầu
                        window.location.href = `http://localhost:8080/search?s=${encodeURIComponent(query)}`;
                    }
                }
                // Hàm chuyển hướng có đối số
                function redirectToSearch2() {
                    const query = mainsearchInput.value.trim(); // Lấy giá trị nhập vào và loại bỏ khoảng trắng thừa
                    if (query) {
                        // Chuyển hướng đến URL mới, có thể tùy chỉnh URL này theo nhu cầu
                        window.location.href = `http://localhost:8080/search?s=${encodeURIComponent(query)}`;
                    }
                }
                // Sự kiện nhấn Enter trong input
                searchInput.addEventListener('keydown', function (event) {
                    if (event.key === 'Enter') {
                        redirectToSearch();
                    }
                });
        
                // Sự kiện click vào icon tìm kiếm
                searchIcon.addEventListener('click', redirectToSearch);
                //Chỉnh placeholder cho chọn ngày đi
                flatpickr("#departureDate", {
                    dateFormat: "d-m-Y", // Định dạng ngày hiển thị
                    onChange: function(selectedDates, dateStr, instance) {
                        // Cập nhật giá trị cho ô input khi chọn ngày
                        document.getElementById('departureDate').value = dateStr;
                    }
                });
                //Khởi tạo Select2
                $(document).ready(function() {
                    $('.location-select').each(function() {
                var type = $(this).data('type'); // Lấy type từ thuộc tính data-type
                var placeholderText = type === 'departure' ? "Chọn điểm đi" : "Chọn điểm đến"; // Đặt placeholder tương ứng
        
                $(this).select2({
                    placeholder: placeholderText,
                    allowClear: true
                        });
                    });
                });
                $('.location-select').on('select2:open', function(e) {
                    $('.select2-results__options').hide().fadeIn(200); // 300ms là thời gian hiệu ứng
                });
        
                // Hiệu ứng Fade Out khi đóng select2
                $('.location-select').on('select2:close', function(e) {
                    $('.select2-results__options').fadeOut(200, function() {
                        $(this).hide(); // Sau khi hiệu ứng kết thúc, ẩn dropdown
                    });
                });
             // xử lý sự kiện ấn nút "tìm kiếm"
                document.getElementById('main-btn-search').addEventListener('click', function() {
                // Lấy giá trị từ các ô input và select
                var tourName = document.getElementById('mainSearchInput').value;
                var startDate = document.getElementById('departureDate').value;
             // Chuyển đổi định dạng ngày từ dd-MM-yyyy sang yyyy-MM-dd
                var formattedStartDate = "";
                if (startDate) {
                    var dateParts = startDate.split('-'); // Tách ngày, tháng, năm
                    if (dateParts.length === 3) {
                        formattedStartDate = dateParts[2] + '-' + dateParts[1] + '-' + dateParts[0]; // Chuyển đổi sang yyyy-MM-dd
                    }
                }
             // Lấy text từ departureSelect
                var departureSelect = document.getElementById('departureSelect');
                var departureText = departureSelect.options[departureSelect.selectedIndex].text; // Lấy text của tùy chọn đã chọn
                var departure = (departureText === "Chọn điểm đi") ? "" : departureText; // Nếu chọn "Chọn điểm đi" thì gán rỗng
            
                // Lấy text từ destinationSelect
                var destinationSelect = document.getElementById('destinationSelect');
                var destinationText = destinationSelect.options[destinationSelect.selectedIndex].text; // Lấy text của tùy chọn đã chọn
                var destination = (destinationText === "Chọn điểm đến") ? "" : destinationText; // Nếu chọn "Chọn điểm đến" thì gán rỗng // Lấy text của tùy chọn đã chọn
                
                console.log("Tour Name: ", tourName);
                console.log("Start Date: ", formattedStartDate);
                console.log("Departure: ", departure);
                console.log("Destination: ", destination);
        
                // Tạo URL với các tham số
                var searchUrl = '/search?'; // Đường dẫn tới trang tìm kiếm
        
                // Thêm các điều kiện vào URL nếu có giá trị
                if (tourName) {
                    searchUrl += 'tourName=' + encodeURIComponent(tourName) + '&';
                }
                if (startDate) {
                    searchUrl += 'startDate=' + encodeURIComponent(formattedStartDate) + '&';
                }
                if (departure) {
                    searchUrl += 'departure=' + encodeURIComponent(departure) + '&';
                }
                if (destination) {
                    searchUrl += 'destination=' + encodeURIComponent(destination) + '&';
                }
        
                // Loại bỏ dấu "&" cuối cùng
                searchUrl = searchUrl.slice(0, -1);
        
                // Redirect đến URL mới
                   window.location.href = searchUrl;
                });
            </script>
    
</body>
</html>
